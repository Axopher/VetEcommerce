{% extends 'main.html' %}
{% block content %}
<div class="my-account-wrapper pb-100 pt-100">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <!-- My Account Page Start -->
                <div class="myaccount-page-wrapper">
                    <!-- My Account Tab Menu Start -->
                    <div class="row">
                        <div class="col-lg-3 col-md-4">
                            <div class="myaccount-tab-menu nav" role="tablist">
                                <a href="#dashboad" class="{% if active_tab != 'orders_history' %}active{% endif %}" data-bs-toggle="tab" aria-selected="{% if active_tab != 'orders_history' %}true{% else %}false{% endif %}" role="tab">Dashboard</a>
                                <a href="#orders" class="{% if active_tab == 'orders_history' %}active{% endif %}" data-bs-toggle="tab" aria-selected="{% if active_tab == 'orders_history' %}true{% else %}false{% endif %}" tabindex="-1" role="tab">Orders</a>
                                <a href="#change-password" data-bs-toggle="tab" aria-selected="false" tabindex="-1" role="tab">Change Password</a>
                                <a href="#payment-method" data-bs-toggle="tab" aria-selected="false" tabindex="-1" role="tab">Payment Method</a>
                                <a href="#account-info" data-bs-toggle="tab" aria-selected="false" tabindex="-1" role="tab">Account Details</a>
                                <a href="{% url 'logout' %}">Logout</a>
                            </div>
                        </div>
                        <!-- My Account Tab Menu End -->
                        <!-- My Account Tab Content Start -->
                        <div class="col-lg-9 col-md-8">
                            <div class="tab-content" id="myaccountContent">
                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade {% if active_tab != 'orders_history' %}active show{% endif %}" id="dashboad" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>Dashboard</h3>
                                        <div class="welcome">
                                            <p>Welcome, <strong>{{request.user}}!!!</strong></p>
                                        </div>

                                        <p class="mb-0">From your account dashboard. you can easily check &amp; view your recent orders, manage your shipping and billing addresses and edit your password and account details.</p>
                                    </div>
                                </div>
                                <!-- Single Tab Content End -->
                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade {% if active_tab == 'orders_history' %}active show{% endif %}" id="orders" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>Orders</h3>
                                        <div style="margin-top: 2rem;margin-bottom:1rem;">
                                        <form id="searchFormOrders" method="get">
                                            <div class="container">
                                                <div class="row">
                                                  <div class="col">
                                                    {{ orderFilter.form.payment_start_date.label }}
                                                    {{ orderFilter.form.payment_start_date }}
                                                  </div>
                                                  <div class="col">
                                                    {{ orderFilter.form.payment_end_date.label }}
                                                    {{orderFilter.form.payment_end_date}}
                                                  </div>
                                                  <div class="col">
                                                    {{ orderFilter.form.status.label }}
                                                    {{ orderFilter.form.status }}
                                                  </div>
                                                  <div class="col">
                                                    <input type="hidden" name="active_tab" value="orders_history">
                                                    <br>
                                                    <button class="form-control filter-button">Apply Filter</button>
                                                  </div>
                                                </div>
                                            </div>
                                        </form>
                                        </div>
                                        <div class="myaccount-table table-responsive text-center">
                                            <table class="table table-bordered">
                                                <thead class="thead-light">
                                                    <tr>
                                                        <th>Date</th>
                                                        <th>status</th>
                                                        <th>Total</th>
                                                        <th>Product</th>
                                                        <th>Quantity</th>
                                                        <th>Price</th>                                                   
                                                        <th>Order Notes</th>
                                                        <th>Transaction ID</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for order in orders %}
                                                    <tr>
                                                        <td>{{ order.date_ordered }}</td>
                                                        <td>{{ order.status }}</td>
                                                        <td>{{ order.get_order_total|floatformat:2 }}</td>
                                                        <td>
                                                            {% for order_item in order.orderitem_set.all %}
                                                            {{ order_item.product.name }}
                                                            {% if not forloop.last %}, {% endif %}
                                                            {% endfor %}
                                                        </td>
                                                        <td>{{ order.get_order_items }}</td>
                                                        <td>
                                                            {% for order_item in order.orderitem_set.all %}
                                                            {{ order_item.product.discounted_price|floatformat:2 }}
                                                            {% if not forloop.last %}, {% endif %}
                                                            {% endfor %}
                                                        </td>
                                                        {% if order.order_notes %}
                                                        <td>{{ order.order_notes }}</td>
                                                        {% else %}
                                                        <td>no notes</td>
                                                        {% endif %}
                                                        <td>{{order.transaction_id}}</td>
                                                        <td><a href="{% url 'order_details' order.id %}" class="check-btn sqr-btn ">View</a></td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                            {% include 'pagination.html' with queryset=orders custom_range=custom_range %}
                                        </div>
                                        
                                    </div>
                                    
                                </div>
                                <!-- Single Tab Content End -->
                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade" id="change-password" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>Change Password</h3>
                                        <div class="myaccount-table table-responsive text-center">
                                            <div class="account-details-form">
                                                <form action="{% url 'change_password' %}" method="POST">
                                                    {% csrf_token %}
                                                    <fieldset>
                                                      <div class="single-input-item">
                                                        {{ form.old_password}}
                                                      </div>
                                                      <div class="row">
                                                        <div class="col-lg-6">
                                                          <div class="single-input-item">
                                                            {{ form.new_password1}}
                                                          </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                          <div class="single-input-item">
                                                            {{ form.new_password2}}
                                                          </div>
                                                        </div>
                                                      </div>
                                                    </fieldset>
                                                    <div class="single-input-item btn-hover">
                                                      <button type="submit" class="check-btn sqr-btn">Save Changes</button>
                                                    </div>
                                                  </form>
                                                  
                                            </div>
                                            
                                        </div>
                                    </div>
                                </div>
                                <!-- Single Tab Content End -->
                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade" id="payment-method" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>Payment Method</h3>
                                        <p class="saved-message">You Can't Saved Your Payment Method yet.</p>
                                    </div>
                                </div>
                                <!-- Single Tab Content End -->
                                <!-- Single Tab Content Start -->
                                <div class="tab-pane fade" id="account-info" role="tabpanel">
                                    <div class="myaccount-content">
                                        <h3>Account Details</h3>
                                        <div class="account-details-form">
                                            <form action="{% url 'profile' %}" method="POST">
                                                {% csrf_token %}
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="first-name" class="required">First Name</label>
                                                            {{profile_form.first_name}}
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="last-name" class="required">Last Name</label>
                                                            {{profile_form.last_name}}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="username" class="required">Username*</label>
                                                            {{profile_form.username}}
                                                        </div>    
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="email" class="required">Email Address*</label>
                                                            {{profile_form.email}}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="single-input-item">
                                                            <label for="phone" class="required">phone number</label>
                                                            {{profile_form.phone}}
                                                        </div>    
                                                    </div>
                                                </div>                                                                                                                               
                                                <div class="single-input-item btn-hover">
                                                    <button class="check-btn sqr-btn">Save Changes</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div> <!-- Single Tab Content End -->
                            </div>
                        </div> <!-- My Account Tab Content End -->
                    </div>
                </div> <!-- My Account Page End -->
            </div>
        </div>
    </div>
</div>

<style>
    .filter-button {
        background-color: grey;
        color: #fff;
        border: none;
        font-size: 16px;
        text-transform: uppercase;
        cursor: pointer;
        margin-left: 0;
        border-radius: 4px;
        }
        
    .filter-button:hover {
        transition: .8s ease-in-out;
        background-color: black;
    }
          
</style>
{% endblock%}